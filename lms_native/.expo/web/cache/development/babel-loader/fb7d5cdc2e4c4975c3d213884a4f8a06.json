{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/opt/lampp/htdocs/codi/LMS/lms_native/Take_Attendance.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState, useEffect } from 'react';\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport { DataTable } from 'react-native-paper';\nimport API from \"./api\";\nimport Attendance from \"./components/Attendance\";\nimport Classroom from \"./components/Classroom\";\nimport Section from \"./components/Section\";\nexport default function Take_Attendance() {\n  var _this = this;\n\n  var _useState = useState({\n    students: [],\n    attendance: {},\n    showSubmit: false\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      state = _useState2[0],\n      updateState = _useState2[1];\n\n  var _useState3 = useState({}),\n      _useState4 = _slicedToArray(_useState3, 2),\n      attendance = _useState4[0],\n      setAttendance = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      _useState6 = _slicedToArray(_useState5, 2),\n      section = _useState6[0],\n      setSection = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      _useState8 = _slicedToArray(_useState7, 2),\n      classroom = _useState8[0],\n      setClassroom = _useState8[1];\n\n  var today = new Date();\n  var year = today.getFullYear();\n  var month = today.getMonth() + 1;\n  var day = today.getDate();\n  if (month < 10) month = \"0\" + month;\n  if (day < 10) day = \"0\" + day;\n  var date = year + '-' + month + '-' + day;\n  var filter = {\n    section: section,\n    classroom: classroom\n  };\n\n  var fetchdata = function fetchdata() {\n    return _regeneratorRuntime.async(function fetchdata$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            setAttendance({});\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(API.post(\"stu-sec-class\").then(function (res) {\n              var result = res.data.data;\n              var data = result.filter(function (s) {\n                return s.section_id == section;\n              });\n\n              if (data) {\n                data.map(function (s) {\n                  var attend = attendance;\n                  attend[s.id] = \"Present\";\n                  setAttendance({\n                    attend: attend\n                  });\n                });\n              }\n\n              setState({\n                students: data\n              });\n            }));\n\n          case 3:\n            _context.next = 5;\n            return _regeneratorRuntime.awrap(API.get(\"attendance\").then(function (res) {\n              var result = res.data.data;\n              var update = result.filter(function (a) {\n                return a.created_at.slice(0, 10) == date && a.section_id == section;\n              });\n\n              if (update && update.length) {\n                update.map(function (s) {\n                  var attend = attendance;\n                  attend[s.student_id] = s.description;\n                  setAttendance({\n                    attend: attend\n                  });\n                });\n              }\n            }));\n\n          case 5:\n            if (classroom == \"\") setSection(\"\");\n            checkSubmit();\n\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var checkSubmit = function checkSubmit() {\n    section != \"\" ? setState({\n      showSubmit: true\n    }) : setState({\n      showSubmit: false\n    });\n  };\n\n  var setState = function setState(nextState) {\n    updateState(function (prevState) {\n      return _objectSpread(_objectSpread({}, prevState), nextState);\n    });\n    console.log(state, filter);\n  };\n\n  var changeDescription = function changeDescription(key, val) {\n    var attend = attendance;\n    attend[key] = val;\n    setAttendance({\n      attend: attend\n    });\n  };\n\n  var submitAttendance = function submitAttendance() {\n    var updateFunction, createFunction;\n    return _regeneratorRuntime.async(function submitAttendance$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            updateFunction = function updateFunction(update) {\n              var _loop, i;\n\n              return _regeneratorRuntime.async(function updateFunction$(_context3) {\n                while (1) {\n                  switch (_context3.prev = _context3.next) {\n                    case 0:\n                      _loop = function _loop(i) {\n                        var student, key, reqBody, att, id;\n                        return _regeneratorRuntime.async(function _loop$(_context2) {\n                          while (1) {\n                            switch (_context2.prev = _context2.next) {\n                              case 0:\n                                student = state.students[i];\n                                key = student.id;\n                                reqBody = {\n                                  description: attendance[key],\n                                  section_id: section,\n                                  student_id: key\n                                };\n                                att = update.find(function (a) {\n                                  return a.student_id == key;\n                                });\n                                id = att.id;\n                                _context2.next = 7;\n                                return _regeneratorRuntime.awrap(API.put(\"attendance/\" + id, reqBody));\n\n                              case 7:\n                              case \"end\":\n                                return _context2.stop();\n                            }\n                          }\n                        }, null, null, null, Promise);\n                      };\n\n                      i = 0;\n\n                    case 2:\n                      if (!(i < state.students.length)) {\n                        _context3.next = 8;\n                        break;\n                      }\n\n                      _context3.next = 5;\n                      return _regeneratorRuntime.awrap(_loop(i));\n\n                    case 5:\n                      i++;\n                      _context3.next = 2;\n                      break;\n\n                    case 8:\n                    case \"end\":\n                      return _context3.stop();\n                  }\n                }\n              }, null, null, null, Promise);\n            };\n\n            createFunction = function createFunction() {\n              return _regeneratorRuntime.async(function createFunction$(_context5) {\n                while (1) {\n                  switch (_context5.prev = _context5.next) {\n                    case 0:\n                      state.students.map(function _callee(student) {\n                        var key, reqBody;\n                        return _regeneratorRuntime.async(function _callee$(_context4) {\n                          while (1) {\n                            switch (_context4.prev = _context4.next) {\n                              case 0:\n                                key = student.id;\n                                reqBody = {\n                                  description: attendance[key],\n                                  section_id: section,\n                                  student_id: key\n                                };\n                                _context4.next = 4;\n                                return _regeneratorRuntime.awrap(API.post(\"attendance\", reqBody));\n\n                              case 4:\n                              case \"end\":\n                                return _context4.stop();\n                            }\n                          }\n                        }, null, null, null, Promise);\n                      });\n\n                    case 1:\n                    case \"end\":\n                      return _context5.stop();\n                  }\n                }\n              }, null, null, null, Promise);\n            };\n\n            _context6.next = 4;\n            return _regeneratorRuntime.awrap(API.get(\"attendance\").then(function (res) {\n              var result = res.data.data;\n              var update = result.filter(function (a) {\n                return a.created_at.slice(0, 10) == date && a.section_id == section;\n              });\n\n              if (update && update.length) {\n                updateFunction(update);\n              } else {\n                createFunction();\n              }\n            }));\n\n          case 4:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  useEffect(function () {\n    fetchdata();\n  }, [JSON.stringify(filter)]);\n  return React.createElement(View, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 9\n    }\n  }, React.createElement(Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 13\n    }\n  }), React.createElement(Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 13\n    }\n  }), React.createElement(View, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 13\n    }\n  }, React.createElement(View, {\n    className: \"helloclass\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 17\n    }\n  }, React.createElement(Classroom, {\n    onValueChange: setClassroom,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 21\n    }\n  }), React.createElement(Section, {\n    id: classroom,\n    onValueChange: setSection,\n    selectedValue: section,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 21\n    }\n  })), React.createElement(TouchableOpacity, {\n    onPress: submitAttendance,\n    style: {\n      display: state.showSubmit ? 'block' : 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 17\n    }\n  }, React.createElement(Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 21\n    }\n  }, \"Submit\"))), React.createElement(View, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 13\n    }\n  }, React.createElement(DataTable, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 17\n    }\n  }, React.createElement(DataTable.Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 21\n    }\n  }, React.createElement(DataTable.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 25\n    }\n  }, \"ID\"), React.createElement(DataTable.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 25\n    }\n  }, \"Name\"), React.createElement(DataTable.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 25\n    }\n  }, \"Class\"), React.createElement(DataTable.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 25\n    }\n  }, \"Attendance\")), state.students.map(function (student) {\n    return React.createElement(DataTable.Row, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 25\n      }\n    }, React.createElement(DataTable.Cell, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 29\n      }\n    }, student.id), React.createElement(DataTable.Cell, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 29\n      }\n    }, student.fname, \" \", student.lname), React.createElement(DataTable.Cell, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 29\n      }\n    }, student.classroom_name, \" \", student.section_name), React.createElement(DataTable.Cell, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 29\n      }\n    }, React.createElement(Attendance, {\n      name: \"attendance\",\n      id: attendance[student.id],\n      onValueChange: changeDescription(student.id, selectedValue),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 33\n      }\n    })));\n  }))));\n}","map":{"version":3,"sources":["/opt/lampp/htdocs/codi/LMS/lms_native/Take_Attendance.js"],"names":["React","useState","useEffect","DataTable","API","Attendance","Classroom","Section","Take_Attendance","students","attendance","showSubmit","state","updateState","setAttendance","section","setSection","classroom","setClassroom","today","Date","year","getFullYear","month","getMonth","day","getDate","date","filter","fetchdata","post","then","res","result","data","s","section_id","map","attend","id","setState","get","update","a","created_at","slice","length","student_id","description","checkSubmit","nextState","prevState","console","log","changeDescription","key","val","submitAttendance","updateFunction","i","student","reqBody","att","find","put","createFunction","JSON","stringify","display","fname","lname","classroom_name","section_name","selectedValue"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Text, View, TouchableOpacity } from 'react-native';\nimport { DataTable } from 'react-native-paper';\nimport API from './api';\n\nimport Attendance from './components/Attendance';\nimport Classroom from './components/Classroom';\nimport Section from './components/Section';\n\nexport default function Take_Attendance() {\n\n    const [state, updateState] = useState({\n        students: [],\n        attendance: {},\n        showSubmit: false,\n    });\n\n    const [attendance, setAttendance] = useState({});\n    const [section, setSection] = useState(\"\");\n    const [classroom, setClassroom] = useState(\"\");\n\n    var today = new Date();\n    var year = today.getFullYear();\n    var month = (today.getMonth() + 1);\n    var day = today.getDate();\n\n    if (month < 10) month = \"0\" + month;\n    if (day < 10) day = \"0\" + day;\n\n    var date = year + '-' + month + '-' + day;\n\n    const filter = {\n        section: section,\n        classroom: classroom,\n    };\n\n    const fetchdata = async () => {\n\n        setAttendance({});\n\n        await API.post(`stu-sec-class`)\n            .then(res => {\n                const result = res.data.data;\n                const data = result.filter(s => s.section_id == section);\n                if (data) {\n                    data.map(s => {\n                        const attend = attendance;\n                        attend[s.id] = \"Present\";\n                        setAttendance({ attend });\n                    });\n                }\n                setState({ students: data });\n            });\n\n        await API.get(`attendance`)\n            .then(res => {\n                const result = res.data.data;\n                const update = result.filter(a =>\n                    (a.created_at.slice(0, 10) == date && a.section_id == section)\n                );\n                if (update && update.length) {\n                    update.map(s => {\n                        const attend = attendance;\n                        attend[s.student_id] = s.description;\n                        setAttendance({ attend });\n                    });\n                }\n            });\n\n        if (classroom == \"\") setSection(\"\");\n        checkSubmit();\n    }\n\n    const checkSubmit = () => {\n        (section != \"\") ? setState({ showSubmit: true }) : setState({ showSubmit: false });\n    }\n\n    const setState = (nextState) => {\n        updateState(prevState => ({\n            ...prevState,\n            ...nextState\n        }));\n        console.log(state, filter);\n    }\n\n    // const handleChange = e => {\n    //     let { name, value } = e.target;\n    //     setState({ [name]: value });\n    // }\n\n    const changeDescription = (key, val) => {\n        const attend = attendance;\n        attend[key] = val;\n        setAttendance({ attend });\n    }\n\n    const submitAttendance = async () => {\n\n        const updateFunction = async (update) => {\n            for (let i = 0; i < state.students.length; i++) {\n                let student = state.students[i];\n                let key = student.id;\n                let reqBody = {\n                    description: attendance[key],\n                    section_id: section,\n                    student_id: key\n                }\n                let att = update.find(a => a.student_id == key);\n                let id = att.id;\n\n                await API.put(`attendance/${id}`, reqBody);\n            }\n        }\n\n        const createFunction = async () => {\n            state.students.map(async (student) => {\n                let key = student.id;\n                let reqBody = {\n                    description: attendance[key],\n                    section_id: section,\n                    student_id: key\n                }\n                await API.post(`attendance`, reqBody);\n            });\n        }\n\n        await API.get(`attendance`)\n            .then(res => {\n                const result = res.data.data;\n                const update = result.filter(a =>\n                    (a.created_at.slice(0, 10) == date && a.section_id == section)\n                );\n                if (update && update.length) {\n                    updateFunction(update);\n                } else {\n                    createFunction();\n                }\n            });\n    }\n\n    useEffect(() => {\n        fetchdata();\n    }, [JSON.stringify(filter)]);\n\n\n    return (\n        <View>\n\n            <Text></Text>\n            <Text></Text>\n\n            <View>\n\n                <View className=\"helloclass\">\n                    <Classroom\n                        onValueChange={setClassroom}\n                    />\n                    <Section\n                        id={classroom}\n                        onValueChange={setSection}\n                        selectedValue={section}\n                    />\n                </View>\n\n                <TouchableOpacity\n                    onPress={submitAttendance}\n                    style={{ display: state.showSubmit ? 'block' : 'none' }}>\n                    <Text>Submit</Text>\n                </TouchableOpacity>\n\n            </View>\n\n            <View>\n                <DataTable>\n                    <DataTable.Header>\n                        <DataTable.Title>ID</DataTable.Title>\n                        <DataTable.Title>Name</DataTable.Title>\n                        <DataTable.Title>Class</DataTable.Title>\n                        <DataTable.Title>Attendance</DataTable.Title>\n                    </DataTable.Header>\n\n                    {state.students.map(student => (\n                        <DataTable.Row>\n                            <DataTable.Cell>{student.id}</DataTable.Cell>\n                            <DataTable.Cell>{student.fname} {student.lname}</DataTable.Cell>\n                            <DataTable.Cell>{student.classroom_name} {student.section_name}</DataTable.Cell>\n                            <DataTable.Cell>\n                                <Attendance\n                                    name=\"attendance\"\n                                    id={attendance[student.id]}\n                                    onValueChange={changeDescription(student.id, selectedValue)}\n                                />\n                            </DataTable.Cell>\n                        </DataTable.Row>\n                    ))}\n                </DataTable>\n            </View>\n        </View>\n    );\n}"]},"metadata":{},"sourceType":"module"}